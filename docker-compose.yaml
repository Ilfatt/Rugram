networks:
  rugram:
    name: rugram_default
services:
  Gateway:
    container_name: Gateway
    image: rugramgateway
    ports:
      - "3000:80"
    restart: always
    build:
      context: .RugramBackend/Gateway
      dockerfile: /Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - AuthOptions__Issuer=RugramAuth
      - AuthOptions__Audience=Rugram
      - AuthOptions__JwtSecretKey=123
      - AuthOptions__AccessTokenLifetimeInMinutes=2
    networks:
      rugram:
        aliases:
          - gateway
  Auth:
    container_name: Auth
    image: rugramauth
    restart: always
    build:
      context: .RugramBackend/Gateway
      dockerfile: Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - AuthOptions__Issuer=RugramAuth
      - AuthOptions__Audience=Rugram
      - AuthOptions__JwtSecretKey=123
      - AuthOptions__AccessTokenLifetimeInMinutes=2
      - AuthOptions__RefreshTokenLifetimeInHours=168
      - AuthOptions__SlidingExpirationInCacheForRefreshTokenInMinutes=5
      - ConnectionStrings__PostreSQL=Server=dbAuth;Port=5432;Database=RugramAuth;User Id=dev;Password=111;Include Error Detail=true;
      - ConnectionStrings__Redis=redisAuth:6379,password=111
    depends_on:
      - DbAuth
      - RedisAuth
    networks:
      rugram:
        aliases:
          - auth
  RedisAuth:
    container_name: RedisAuth
    image: redis:6.2-alpine
    restart: always
    command: redis-server --save 20 1 --loglevel warning --requirepass 111
    networks:
      rugram:
        aliases:
          - redisAuth
  DbAuth:
    container_name: DbAuth
    image: postgres:alpine
    restart: always
    environment:
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: 111
      POSTGRES_DB: RugramAuth
    networks:
      rugram:
        aliases:
          - dbAuth